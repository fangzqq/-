# 架构与架构图

参考自：https://www.infoq.cn/profile/1671085/publish

架构是一种整体与局部关系的抽象描述：

- 架构要素，可以是子系统、模块、应用服务
- 结构，不同的软件系统会有不同的结构，这些结构是为解决不同场景而设计的
- 连接，通过定义架构元素之间的接口和交互关系、集成机制，实现架构元素之间的连接。连接可以是分布式调用、进程间调用、组件之间的关系等

架构 = 要素 + 结构 + 连接，将系统要素按照特定结构进行连接交互

```
The software architecture of a program or computing system is the structure or structures of the system, which comprise software elements, the externally visible properties of those elements, and the relationships among them.
```

## 架构域的分类

架构域包括：

- 业务架构
- 数据架构
- 产品架构
- 应用架构
- 技术架构

首先需要熟悉业务，形成业务架构，根据业务架构，做出相应的数据架构和应用架构，最后通过技术架构落地实施。应用架构是承上启下，一方面承接业务架构的落地，另一方面影响技术架构的选型。既要针对当前需求选择合适的架构，又要面向未来，能够保证架构平滑过渡。

### 业务架构

在需求初期，业务的需求描述往往比较模糊，此时应该把这个产品所有的问题域列清楚。问题域是指产品能够解决的所有问题的空间集合，从核心需求出发，将所有当前需要解决、未来可能要解决的问题放入产品框架的范围。

业务架构就是在业务需求初期，将模糊的需求描述转变成清晰的问题域，根据问题域的答案抽象总结成一个确定的产品需求，梳理出清晰的业务流程。

业务架构需要对业务进行拆分，对领域模型进行设计，把现实的业务转化成抽象对象。经过业务架构阶段之后，需要输出的产物包括：

- 战略方向图
- 问题域列表
- 业务流程图

### 数据架构

从业务架构分析业务流程、定义数据架构，流程和数据结合定义产品架构。数据架构主要解决三个问题：

- 系统需要什么样的数据
- 如何存储这些数据
- 如何进行数据架构设计

业务流程离不开数据流转，业务运营状况通过数据反映。数据架构中的数据包含静态数据和动态数据。

数据架构是为了建立一个共享、通用、一致的数据基础平台，解决信息孤岛问题。数据存储的分布策略有两种：

- 集中式存储
- 分布式存储

数据源自于企业的业务流程，从业务流程中我们可以找出领域对象，基于领域对象进行分析，就能得到对象的属性。根据业务关系进而抽取领域对象之间的关系。通过领域建模，我们不仅能清晰的反映企业的业务域，还能清晰的描绘出一幅企业的数据模型。数据模型最常用的视图就是 ER 图：

- 实体（Entiy），企业领域对象
- 属性（Attribute），领域对象的属性
- 联系（RelationShip），两个领域对象之间的关系

### 产品架构

产品架构就是将不同用途的功能模块围绕特定的业务目标进行分类整合。功能模块是用户能够完成一个操作的最小粒度的完整功能。一个产品中不同的功能模块之间的关系分为直接关系和间接关系。

只有具有直接关系的功能模块才会被组织到一起，形成一个子系统。当具有直接关系的功能模块组合成一个子系统后，解决相同问题域的子系统就形成一个功能层级。功能层级按照接近用户实操的距离程度进行从上到下，或者从左至右的划分，这就形成了产品架构的分层。而那些存在间接关系的模块，会在不同的层级通过直接关系的模块产生联系。

### 应用架构

应用架构是要说明产品架构分哪些应用系统，应用系统是如何集成的。应用架构在产品架构的基础上，考虑两个事情：

- 子系统间的关系
- 将可复用的组件或模块进行下沉，沉淀到平台层，为业务组件提供统一的支撑

应用架构在规划时，需要遵循以下几个原则：简单性、灵活性、整合性

### 技术架构

技术架构是应接应用架构的技术需求，并根据识别的技术需求，进行技术选型，把各个关键技术和技术之间的关系描述清楚。技术架构解决的问题包括：

- 纯技术层面的分层
- 开发框架的选择
- 开发语言的选择
- 涉及非功能性需求的技术选择

技术架构是将产品需求转变为技术实现的过程。

## 为什么要画架构图

画架构图可以：
- 梳理自己对产品和技术方向的判断
- 提供产品、技术、运营的输出
- 让他人可视化的理解你的架构
- 提供面向不同人员的视图语言

## 何时需要画架构图

在复杂项目开始前画。当你要开始设计一个系统性、完整性的系统时，如果一开始就跳过设计产品架构图、技术架构图，直接开始写文档、画 demo，就很容易发生改了又改，做了又推翻的情况。

## 如何画架构图

在架构设计过程中，架构分解是必不可少的关键步骤，而这需要一套架构分解的过程模型和过程方法来指导分解。根据以上架构的分类，依次需要产出业务架构图、数据架构图、产品架构图、应用架构图和技术架构图。

---
---

## 从领域模型提取数据架构


## 单体式域分布式的应用架构


## 技术架构的战略和战术原则

战略层的设计原则就是：合适、简单、演化。

了解清楚每种技术的产生背景、适用场景，才能出一个对自己项目最优的选择。技术选型没有最新，只有最合适。合适原则就是适合优于业界领先。

软件领域的结构复杂性和逻辑复杂性。

软件架构需要根据业务发展不断变化，演化原则就是演化优于一步到位。

战术层的设计原则：高并发、高可用、业务设计原则。

### 高并发原则

需要考虑以下几个方面的设计：无状态、拆分、服务化、消息队列、数据异构、缓存。

无状态：无状态应用，便于水平扩展；有状态配置可通过配置中心实现无状态。

拆分：系统维度，按照系统功能、业务拆分；功能维度，对系统功能再做细粒度拆分；读写维度，读多可考虑多级缓存，写多可考虑分库分表；AOP 维度，根据访问特征，按照 AOP 进行拆分；模块维度，对整体代码结构划分。

服务化：考虑服务分组、隔离、限流、黑白名单、超时、重试机制、路由、故障补偿等。

消息队列：服务解耦（一对多消费）、异步处理、流量削峰缓冲等。

数据异构：通过消息队列机制接受数据变更，原子化存储。

缓存：用户层，DNS 缓存，客户端缓存；代理层，CDN 缓存；接入层，Nginx 的 Proxy_cache 代理缓存，或者 Nginx + Lua + Redis 做业务数据缓存。

应用层：页面静态化、业务数据缓存、消息队列

数据层：NoSQL（Redis、Memcache等）

## 技术架构图

技术架构图分为两类：

- 功能需求技术架构图，逻辑架构图
- 非功能需求技术架构图，物理架构图


